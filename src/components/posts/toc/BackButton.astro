---
import { cn } from '~/lib/utils'
import { POSTS_CONFIG, EDUCATION_CONFIG, PROJECTS_CONFIG } from '~/config'
import type { CollectionEntry } from 'astro:content'

interface Props {
  class?: string
  post: CollectionEntry<'posts'> | CollectionEntry<'education'> | CollectionEntry<'projects'>
  posts: (CollectionEntry<'posts'> | CollectionEntry<'education'> | CollectionEntry<'projects'>)[]
}

const { class: className, post, posts } = Astro.props

// Determina la collezione e la configurazione corrispondente
const collection = post.collection
let baseUrl: string
let pageSize: number
let backText: string

if (collection === 'education') {
  baseUrl = '/education'
  pageSize = EDUCATION_CONFIG.postPageConfig.size
  backText = EDUCATION_CONFIG.backToEducationText
} else if (collection === 'projects') {
  baseUrl = '/projects'
  pageSize = PROJECTS_CONFIG.postPageConfig.size
  backText = PROJECTS_CONFIG.backToProjectsText
} else {
  baseUrl = '/posts'
  pageSize = POSTS_CONFIG.postPageConfig.size
  backText = POSTS_CONFIG.backToPostsText
}

// 计算文章在第几页
const postIndex = posts.findIndex((p) => p.id === post.id)
const pageNumber = Math.floor(postIndex / pageSize) + 1
const pageUrl = pageNumber === 1 ? baseUrl : `${baseUrl}/${pageNumber}`
---

<a
  href={pageUrl}
  class={cn(
    'group flex items-center gap-2 px-3 py-2 bg-primary/4 hover:bg-primary/10 text-primary/70 hover:text-primary transition-colors duration-200 dark:bg-primary/10 dark:hover:bg-primary/15',
    className
  )}
  aria-label={backText}
>
  <span class="icon-[ph--arrow-left] size-4 transition-transform duration-200 group-hover:-translate-x-0.5"></span>
  <span class="text-sm font-medium">{backText}</span>
</a>
