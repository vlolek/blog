---
import AuthorCard from '@/components/AuthorCard.astro'
import BlogCard from '@/components/BlogCard.astro'
import Link from '@/components/Link.astro'
import PageHead from '@/components/PageHead.astro'
import ProjectCard from '@/components/ProjectCard.astro'
import { buttonVariants } from '@/components/ui/button'
import { SITE } from '@/consts'
import Layout from '@/layouts/Layout.astro'
import {
  getAllEducation,
  getAllProjects,
  getAuthorById,
  getRecentPosts,
} from '@/lib/collections'

const blog = await getRecentPosts(
  SITE.featuredPostCount,
)
const author = await getAuthorById(
  'vladlenoleksiuk',
)
// Prendi i primi 3 progetti più recenti (già ordinati per startDate da getAllProjects)
const projects = (await getAllProjects()).slice(
  0,
  3,
)
// Prendi i primi 3 articoli di formazione più recenti
const education = (await getAllEducation()).slice(
  0,
  3,
)
---

<Layout class="max-w-3xl space-y-6">
  <PageHead includeOrganization={true} />

  <section>
    <h1 class="mb-4 text-3xl font-medium">
      {SITE.title}
    </h1>
    {author && <AuthorCard author={author} />}
  </section>

  {
    blog.length > 0 && (
      <section
        class="flex flex-col gap-y-4"
        aria-labelledby="ultimi-post-heading"
      >
        <div class="flex items-center justify-between border-b pb-2">
          <h2
            id="ultimi-post-heading"
            class="text-xl font-medium tracking-wider uppercase"
          >
            Ultimi post
          </h2>
          <Link
            href="/blog"
            class={
              buttonVariants({
                variant: 'ghost',
                size: 'sm',
              }) + ' group'
            }
            title="Vedi tutti i post del blog"
          >
            Tutti
            <span
              class="ml-1.5 transition-transform group-hover:translate-x-1"
              aria-hidden="true"
            >
              &rarr;
            </span>
          </Link>
        </div>
        <ul
          class="flex flex-col divide-y"
          aria-label="Lista degli ultimi post del blog"
        >
          {blog.map((post) => (
            <li>
              <BlogCard entry={post} />
            </li>
          ))}
        </ul>
      </section>
    )
  }

  {
    education.length > 0 && (
      <section
        class="flex flex-col gap-y-4"
        aria-labelledby="ultimi-articoli-formazione-heading"
      >
        <div class="flex items-center justify-between border-b pb-2">
          <h2
            id="ultimi-articoli-formazione-heading"
            class="text-xl font-medium tracking-wider uppercase"
          >
            Formazione
          </h2>
          <Link
            href="/education"
            class={
              buttonVariants({
                variant: 'ghost',
                size: 'sm',
              }) + ' group'
            }
            title="Vedi tutti gli articoli di formazione"
          >
            Tutto
            <span
              class="ml-1.5 transition-transform group-hover:translate-x-1"
              aria-hidden="true"
            >
              &rarr;
            </span>
          </Link>
        </div>
        <ul
          class="flex flex-col divide-y"
          aria-label="Lista degli ultimi articoli di formazione"
        >
          {education.map((article) => (
            <li>
              <BlogCard entry={article} />
            </li>
          ))}
        </ul>
      </section>
    )
  }

  {
    projects.length > 0 && (
      <section
        class="flex flex-col gap-y-4"
        aria-labelledby="ultimi-progetti-heading"
      >
        <div class="flex items-center justify-between border-b pb-2">
          <h2
            id="ultimi-progetti-heading"
            class="text-xl font-medium tracking-wider uppercase"
          >
            Progetti
          </h2>
          <Link
            href="/projects"
            class={
              buttonVariants({
                variant: 'ghost',
                size: 'sm',
              }) + ' group'
            }
            title="Vedi tutti i progetti"
          >
            Tutti
            <span
              class="ml-1.5 transition-transform group-hover:translate-x-1"
              aria-hidden="true"
            >
              &rarr;
            </span>
          </Link>
        </div>
        <ul
          class="flex flex-col divide-y"
          aria-label="Lista degli ultimi progetti"
        >
          {projects.map((project) => (
            <li>
              <ProjectCard project={project} />
            </li>
          ))}
        </ul>
      </section>
    )
  }
</Layout>
